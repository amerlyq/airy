#!/bin/bash -eu
set -o pipefail
## DEV:
# Так же вести себя и с пулом -- прошёл успешно если чистый или нужен коммит,
# стэш, merge итп -- парсить и заменять на значки
cd "${1:-$PWD}"
ignore=$([[ ! -s ./.freeze ]] || awk -vp="$PWD" '{print p"/"$0}' ./.freeze)
exec r.git-find \
  | grep -zvsxF -f <(<<<"$ignore") \
  | parallel -0 -j1 -k '
  echo && r.git-status {} &&
  git-up {} 2>&1 &&
  r.git-status {} && echo'
# DISABLED:(ruby/git-up) -- became very bugged
