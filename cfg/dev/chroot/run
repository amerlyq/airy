#!/bin/bash -e

dir="${PWD#/cryptfs/chroots/lucid_i386}"
[[ "$dir" != "$PWD" ]] || dir=/cryptfs/workspace

# EXPL Export SHELLRC_EVAL to source env in each spawned shell from ranger
export SHELLRC_EVAL='. /cryptfs/_/cfg/env; . /cryptfs/_/cfg/bash_extension.sh; export DISPLAY='$DISPLAY'; export EDITOR=vim'
schroot -c lucid_i386 -d "$dir" -- bash -l ${@:+-c "$@"}


# ALT: NOTE failed to setup schroot.conf to export only choosen env variables.
# schroot -c lucid_i386 -d "$dir" -- bash --rcfile <(echo "
#     export SHELLRC_EVAL='. /cryptfs/_/cfg/env; . /cryptfs/_/cfg/bash_extension.sh'
#     export DISPLAY='$DISPLAY'
#     . ~/.bashrc
#     EDITOR=vim
# ") ${@:+-c $@}
