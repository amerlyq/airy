#!/bin/bash -e

dir="${PWD#/cryptfs/chroots/lucid_i386}"
[[ "$dir" != "$PWD" ]] || dir=/cryptfs/workspace

# EXPL Export BASHRC_EVAL to source env in each spawned shell from ranger
# NOTE failed to setup schroot.conf to export only choosen env variables.
schroot -c lucid_i386 -d "$dir" -- bash --rcfile <(echo "
    export BASHRC_EVAL='. /cryptfs/_/cfg/env; . /cryptfs/_/cfg/bash_extension.sh'
    export DISPLAY='$DISPLAY'
    . ~/.bashrc
    EDITOR=vim
") ${@:+-c $@}
