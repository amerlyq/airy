#!/bin/bash -e
source ~/.shell/func.d/cfgsetup

if distro arch; then
    dir=/etc/dict
elif distro ubuntu; then
    dir=/etc/dictd
fi

# Backup older dir (hovewer, it seems always the same)
if [[ -e $dir && ! -L $dir ]]; then sudo mv -vf -- $dir ${dir}_; fi
# Create symlink, if it doesn't exist or points to another place
[[ "$PWD/cfg" -ef $dir ]] || sudo ln -sfvT "$PWD/cfg" $dir

if cfgOpt u; then
    ## Add dictionaries to dictd
    "$PWD/scripts/indexate"
    # mv mydict.dict mydict.index /usr/share/dictd/
    # echo "~/installer/Dics" >> /etc/dictd/dictd.order

    if distro arch; then
        sudo touch /var/lib/dictd/db.list
        if ! systemctl is-enabled dictd; then
            sudo systemctl enable dictd
        fi
        sudo systemctl restart dictd

    elif distro ubuntu; then
        sudo dictdconfig --write
        ## Re-read configuration file
        # /etc/init.d/dictd restart
        # pid=$(pgrep dictd) && sudo kill -SIGHUP $pid
        sudo service dictd restart
    fi
fi

echo "C: 'dict' done"
