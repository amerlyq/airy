#!/bin/bash -e

session="$1"

# USAGE:
#   startx
#   startx ~/.xinitrc xmonad
#   startx /full/path/to/window-manager
#   ALT xinit -- :1 -nolisten tcp vt$XDG_VTNR
#   pkill -15 Xorg

# Merge in defaults and resources
XINT=/etc/X11/xinit
[[ ! -f "$XINT/.Xresources" ]] || xrdb -merge "$XINT/.Xresources"
[[ ! -f "$HOME/.Xresources" ]] || xrdb -merge "$HOME/.Xresources"

# Start dbus, ... -- populated from packages
if [[ -d "$XINT/xinitrc.d" ]] ; then
    for f in "$XINT/xinitrc.d"/?*
    do [[ ! -x "$f" ]] || source "$f"
    done
fi

# Source X settings and programs
# CHECK:SEE: double-sourcing of xprofile by DM
#   https://wiki.archlinux.org/index.php/xprofile
[[ ! -f "$HOME/.xprofile" ]] || source "$HOME/.xprofile"


# BUG: may affect problems for multiple X-sessions
lau(){ if hash $1 >/dev/null; then pgrep $1 >/dev/null || $@ & fi; }
## Keylayout
lau r.xkb
lau r.xcape
lau r.touchpad
lau compton  # Must be launched before installing wallpaper!
lau r.dunst
lau r.feh

# ADD https://wiki.archlinux.org/index.php/Running_program_in_separate_X_display
# Launch session
case "${session:=i3}"
in xterm) exec xterm -geometry 80x66+0+0 -name login
;; *) exec "$session"
esac >/var/tmp/"${session}_$(date +%Y%m%d_%H%M%S).log" 2>&1
