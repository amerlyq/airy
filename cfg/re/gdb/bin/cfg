#!/bin/sh -eu
# USAGE: export OLD_BDR='...' SRC_DIRS='src/dir1:src/dir2'
# FIND: how to extract from coredump
#   * 'cdir' to setup 'OLD_BDR'
#   * list of relative src dirs to setup 'SRC_DIRS'
# TODO:THINK: substitute-path by empty to search rel path in dirs

# NOTE:(pagination off): no need when running with '-batch'

cat> "$(r.gdb-tmp)"/init.cfg <<EOT
# vim:ft=gdb
# set auto-load safe-path "$PWD"
set pagination off
set logging overwrite on
set print thread-events off
# OR: sysroot
set solib-absolute-prefix root
set solib-search-path libs
${OLD_BDR+set substitute-path $OLD_BDR bdr}
set directories src:\$cdir:\$cwd${SRC_DIRS+:$SRC_DIRS}
file exe
core-file core
set logging on log.cfg
EOT
