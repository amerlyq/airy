#!/bin/bash
cd $(dirname $(readlink -m ${0})) || exit
THEME=${CURR_THEME:-dark}

case "$1" in
 dark|light) THEME="$1" ;;
--clean) echo "nothing" ;;
-u|--update) update="$1" ;;
esac


# Main destination for Zsh
ZDOTDIR=~/.cache/zsh
PREZTO="$ZDOTDIR/.zprezto"
mkdir -vp "$ZDOTDIR"

if [[ ! -d "$PREZTO" ]]; then
    git clone --recursive https://github.com/sorin-ionescu/prezto.git "$PREZTO"
fi

# Exec in /usr/bin/zsh only!
# setopt EXTENDED_GLOB
# for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
#   ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
# done
link(){ [[ ! -e $2 || -L $2 ]] && ln -sfvT "$1" $2; }

link "$PWD/zshenv" ~/.zshenv
link "$PWD/prompt" "$PREZTO/modules/prompt/functions/prompt_amer_setup"

for nm in zlogin zprofile zshrc zpreztorc
do link "$PWD/$nm" "$ZDOTDIR/.${nm##*/}"; done


# chsh -s /bin/zsh

if [[ "$update" -eq 1 ]]; then
    (cd "$PREZTO" && git pull && git submodule update --init --recursive)
fi
