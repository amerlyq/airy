# vim:ft=zsh:ts=2:sw=2:sts=2
# Executes commands at login post-zshrc.
# BUG:WARNING: urxvt (but not st) sources this file on each startup!

# Print a random, hopefully interesting, adage.
# if (( $+commands[fortune] )); then
#   if [[ -t 0 || -t 1 ]]; then
#     fortune -s
#     print
#   fi
# fi

# WARNING: can't be placed into ~/.zshenv because PATH then not constructed yet.
# NOTE: Only main Xorg session controlled by systemd.
#   -- Other specialized servers are launched by 'startx' as before.
if [[ ! ($TMUX||$VIM||$EMACS) && $UID > 0 && $XDG_VTNR == 1
&& ! -f /tmp/.X11-unix/X0 && $(tty) == /dev/tty1
]]; then
  systemctl --user set-environment DISPLAY=:0  # XAUTHORITY
  systemctl --user import-environment XDG_VTNR PATH
  # TODO:FIND: how to 'exec' into main target
  setopt norcs  # Skip loading of all subsequent rc files
  systemctl --user start main.target
fi

# BUG: seems like it causes long delay before Xorg on cold system
# OR: delay is caused by long connection (auth) to X
# ((0==$#commands[r.init])) || r.init
# dinit=~/aura/airy/cfg/core/init
# [[ -f $dinit/run ]] && exec $dinit/run || ((0==$#commands[r.init])) || exec r.init
# _dttime end-zlogin
