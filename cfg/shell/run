#!/bin/sh

# BAD? zsh launched raw or after ranger -- has SHELL=/usr/bin/zsh
#   instead of =.../r.shell. OR it's intended behaviour?

# EXPL: simplify when r.shell -c $SHELL
if [ "$#" -eq 2 ] && [ "$1" == -c ]
then if [ "$2" == "$SHELL" ] || [ "$2" == '$SHELL' ]
then shift 2; fi; fi

# EXPL: overwrite when SHELL=r.shell
[ -x /usr/bin/zsh ] \
&& export SHELL=/usr/bin/zsh \
|| export SHELL=/bin/bash

# USE: Interactive shell
[ "$1" != -c ] && exec ${SHELL:?} "$@"

# USE: Cmdline populated with aliases
[ "$1" != -c ] || shift
exec ${SHELL:?} -c '
type -f _has_pr &>/dev/null || _has_pr(){ hash "$1" &>/dev/null; }
(( $(id -u) )) || HOME=/home/${SUDO_USER:-${USER:-${USERNAME:?}}}
source ~/.shell/aliases
if [[ ${SHELL:?} =~ zsh$ ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/modules/git/alias.zsh"
  setopt aliases
else
  shopt -s expand_aliases
fi
eval "$@"
' "$0" "$@"
