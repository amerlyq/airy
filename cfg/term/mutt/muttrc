# show mail list before it's content
set my_cfg=~/.mutt/cfg
set my_cache=~/.cache/mutt

# Show
set pager_index_lines=6     # keep N lines of index on top of pager
set pager_context=3         # context lines when going to next page
set pager_stop=yes          # stop instead of displaying next mail

set editor = "$EDITOR -c 'set spell spelllang=ru_yo,en_us,uk'"
# set edit_headers          # see the headers when editing
set sort = reverse-threads  # reverse-threads -- sort by newest conversation first
set sort_aux = last-date-received
set send_charset="us-ascii:utf-8"

## Show only important fields in the header
# ignore *
# unignore from resent-from reply-to x-mailer user-agent date to cc subject
## Order for display of the header fields
# hdr_order From: Resent-From: Reply-To: X-Mailer: User-Agent: Date: To: Cc: Subject:
set indent_str="> "         # Set quotemark to 1 byte
unset collapse_unread       # never collapse unread messages
set uncollapse_jump         # jumps to first unread msg of thread on uncollapse
set index_format="%M|%4C %Z %{%b %d} %-15.15L (%?l?%4l&%4c?) %s"
# %M
# set index_format = "{%M} $index_format"
# SEE uncollapse_jump
#   http://www.rdrop.com/docs/mutt/manual118.html

# NOTE: only in index; open in pager to apply func to current msg only.
set auto_tag = yes          # auto-apply func to all tagged (w/o ';' prf)

# confirmation skipping
# set fast_reply=yes        # when replying, don't prompt for address
set include=ask-yes         # include original text on reply?
# set forward_quote=yes     # include original text on forward?
# set delete=yes            # don't ask for delete confirmation
set print=ask-yes           # Ask before printing
set confirmappend = no      # silent save on 's'

set use_from = yes          # to ensure mutt doesn't put user@localhost.localhost
set abort_nosubject = yes   # Cancel a message when subject is blank
set copy = yes              # keep copies of outgoing mail.
set move = no

set ssl_starttls = yes  # activate TLS if available on the server
set ssl_force_tls= yes  # always use SSL when connecting to a server
# Display download progress every 5K
set net_inc=5

# IMAP | enough only set local dirs
# Don't wait to enter mailbox manually
unset imap_passive
## Check incoming: Reduce polling frequency to a sane level
set mail_check=60
# Urgent bell in terminal on new mail
set beep
set beep_new
# And poll the current mailbox more often (not needed with IDLE in post 1.5.11)
set timeout=20
set imap_keepalive = 900
# Automatically poll subscribed mailboxes for new mail (new in 1.5.11)
set imap_check_subscribed


# POP3 | needs to create local dirs manually
#   touch ~/work/mail/inbox
### If I will use getmail
set mbox_type=Maildir

set pop_reconnect = yes
set pop_checkinterval = 60
unset pop_delete
# Similar to IMAP, a pop_authenticators option also exists
# MAYBE: cures problem of not prompting for password on cmdline send
# set smtp_authenticators = 'gssapi:login'

## DIRS
# set folder = ~/work/mail
# keep a cache of headers for faster loading (1.5.9+?)
set header_cache     = $my_cache/headers
set message_cachedir = $my_cache/messages      # fetch imap msgs on disk instead of memory
set certificate_file = $my_cache/certificates
# set signature = ~/.mutt/signature  # Set in account


## ALIASES (fast access to contacts)
set alias_file = $my_cache/aliases
set sort_alias = alias
set reverse_alias = yes
source $alias_file


## BINDING
# Speed up folders switch
set sleep_time = 0
source $my_cfg/keyrc
# source $my_cfg/gpgrc          # Keyring
source $my_cache/theme          # Theme

# BUT:TRY:FIX using unmailboxes -- impossible to watch multiple accounts simultaneously
folder-hook  . 'unmailboxes *'  # Necessary to reset connections
source $my_cache/index          # List of accounts (generated)
# Query DFL acc from env ACC=... or from symlink ./default
source "~/.mutt/exe/acc $my_acc_dfl |"
# BUG:(mutt -f ...) loads dfl password anyways
#   => NEED check if '-f' was used; OR: always use $ ACC=... mutt
set my_acc = $my_acc_dfl
source $my_cfg/acc-load

# NOTE: setup inside accounts. BUT? how to reset on account switch?
# save-hook . '=Spam'           # DFL folder to save/move

folder-hook . 'push <collapse-all>'
# folder-hook . 'push ":set collapse\_unread=no<enter>"'


## HTML enriched mails
set mailcap_path = $my_cfg/mailcap
alternative_order text/plain text/enriched text/html     # save html for last
set implicit_autoview=yes  # Load in pager if setting in .mailcap says 'copiousoutput'
auto_view text/html                                      # view html automatically
