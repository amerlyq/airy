#!/bin/bash -e
source ~/.shell/func.d/cfgsetup

### LINKS ###
link "$PWD" ~/.vim
link "$PWD" "${XDG_CONFIG_HOME:=$HOME/.config}/nvim"

cache=${XDG_DATA_HOME:=~/.cache}
mkdir -vp "$cache"/{shada,vim}
cfgNo c || rm -rf "$cache"/vim/*

### SPELL ###
# WARNING: first clean install will always fail as uk*.sug file is absent!
# DEPRECATED:(use pacman with vim-spell-* -- but it won't work for nvim)
dst=$cache/vim/runtime/spell
if [[ ! -d $dst ]]; then
    has_pr wget
    mkdir -p "$dst"
    src='http://ftp.vim.org/pub/vim/runtime/spell'
    for nm in {ru,en,uk}.utf-8.{spl,sug}; do
        wget "$src/$nm" -O "$dst/$nm" || echo "No spl: $nm"
    done
fi

dir=$cache/vim/dein/repos/github.com/Shougo
mkdir -vp "$dir"
for r in Shougo/{dein,vimproc}.vim; do
  dst=$dir/${r##*/}
  if [[ ! -d $dst ]]; then
    git clone --branch master --single-branch --depth=1 \
      "https://github.com/$r" "$dst"
    [[ ! -f $dst/Makefile ]] || (cd "$dst" && make)
  fi
done
