#!/bin/bash -e
source ~/.shell/func.d/packages

if distro arch; then
    pkg_inst -p 'nvim' neovim
    pkg_inst -y 'neovim' python-neovim
    pkg_inst -Y 'neovim' python2-neovim
    pkg_inst -y 'yaml' python-yaml
    pkg_inst -y 'jedi' python-jedi

    ## External deps
    # aur_inst zeal
    pkg_inst hlint
    ## For vim-clang-format and vim-autoformatter
#    pkg_inst -p 'clang-format' clang-tools-extra
#    pkg_inst astyle tidy
#    aur_inst js-beautify  # BAD python-autopep8 beautify-css

elif distro ubuntu; then
    # for vimoutliner export in mindmap
    pkg_inst vim-gtk python3-yaml
    # libclang-dev for autocompleter in vim
    pkg_inst libclang-dev clang-format-3.5
    pip_inst jedi  # neovim
    echo "Err: not all"
fi

### PLUGINS ###
VCACHE=~/.cache/vim && mkdir -vp "$VCACHE"
if cfgOpt u || [[ ! -d $VCACHE/bundle ]]; then
    # BUG: returns non-zero errcode!
    # FIXME: error on clean system, when NeoBundle is not installed yet
    shvim() { $EDITOR -nesR -i NONE -u "$PWD/vimrc" \
        -c "set nomore|redir!>/dev/stderr" -c "$1" \
        -c "echo''|redir END|qall!" >/dev/null ||:; }
    shvim 'NeoBundleClearCache'
    shvim 'NeoBundleUpdate!'
    ! has_pr nvim || shvim 'UpdateRemotePlugins'
fi
