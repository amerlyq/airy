#!/usr/bin/env bash
# source ~/.shell/func.d/bash-profiler
cd "${BASH_SOURCE[0]%/*}" || exit 1

WND_ACTIVE="$(~/.i3/ctl/get_active_wnd)"

for pf in ./profile.d/*; do
    line="$(sed -n '/^#:\s*\(.*\)$/{s//\1/p;q}' "$pf")"
    if [ -z "$line" ]; then continue; fi
    if ! awk "/${line}/ {exit 1}" <<< "$WND_ACTIVE"; then
        WCURR_PROF="${pf##*/}"
        WCURR_MODE=" : $(cat /tmp/aura/wacom_mod)"
    fi
done

echo "${WCURR_PROF}${WCURR_MODE}"
[[ $WCURR_PROF == $(cat /tmp/aura/wacom_prof) ]] && exit
echo "$WCURR_PROF" > /tmp/aura/wacom_prof

./profile.d/default >/dev/null
${WCURR_PROF:+./profile.d/$WCURR_PROF >/dev/null}
./ctl/change-mode -q --refresh
