#!/bin/bash -eu
shopt -s nullglob

while getopts 'qt:p:' o; do case $o in :|'?') exit 1
;; t) bin=$(readlink -e "$OPTARG")
;; p) prf=$OPTARG
;; q) quiet=1
esac; done; shift $((OPTIND - 1))

[[ ${bin-} ]] || bin=$(r.airy-get-cache)/bin
[[ ${prf-} ]] || prf='r.%d-'
prf=${prf//%d/${PWD##*/}}

# run* -> bin/r.%d%n, bin/* -> bin/r.%d-%n
linkcp ${quiet:+-q} -t "$bin" -p "${prf%-}" -s 'run/' ./run*
linkcp ${quiet:+-q} -t "$bin" -p "${prf}" ./bin/*

# DEV: filter only [[ -x .. ]]
# lst=$(find . -maxdepth 1 -type f -name 'run*' -not -empty -executable -print0)
# a=(); while IFS= read -rd $'\0'; do a+=("$REPLY"); done <<< "$lst"
