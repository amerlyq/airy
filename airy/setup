#!/bin/bash -eu
# NOTE: prolog must be completely independent
# BAD!RFC: dirty code duplication
#   => ALT: call ./run from ./setup to pre-initialize

cd "$(dirname "$(readlink -e "$0")")"
repo=$(git -C "$PWD" rev-parse --show-toplevel)
cache=$repo/_build
bin=$cache/bin


### LINKS ###
# FIXME: Subject to completely eliminate = ? replace by env var ?
[[ -L ~/.shell ]] || ln -svT "$repo/cfg/shell" ~/.shell
[[ -L ~/.bin   ]] || ln -svT "$repo/bin" ~/.bin


mkdir -p "$bin"
[[ :$PATH: == *:$HOME/.bin:* ]] || export PATH=$HOME/.bin:$PATH
[[ :$PATH: == *:$bin:* ]] || export PATH=$bin:$PATH


### MAIN ###
./bin/cache-links -t "$cache/bin" -q
./bin/cache-alias -o "$cache/aliases"
