#!/bin/bash

# +xrandr --addmode VBOX0 "1920x1080_60.00" --size 1920x1080 --dpi 82x82

if [ "$1" == "-h" ]; then echo "
display             | Updates monitor
display [LRUDS][p]  |
    left,right,up,down; same; primary

# arandr -- simple GUI for xrandr
"; exit; fi

FL=~/.cache/displayside
## Save option
if [  -f "$FL" ]; then SETS="$(cat "$FL" | sed q)"; else SETS="S"; fi
if [ ! -z "$1" ]; then SETS="$1"; fi
echo "$SETS" > "$FL"

## Choose side
SIDE="${SETS/[pP]}"
case "$SIDE" in
    l|L) PLACE='--left-of' ;;
    r|R) PLACE='--right-of' ;;
    u|U) PLACE='--above' ;;
    d|D) PLACE='--below' ;;
    s|S) PLACE='--same-as' ;;
      *) PLACE='--right-of' ;;
esac

## Get primary
MON=(`xrandr | grep ' connected' | sed 's/^\([^ ]*\).*/\1/'`)
if [ "$SETS" != "$SIDE" ] && [ ${#MON[@]} -ge 2 ]
then INDP=1; else INDP=0; fi
# if [ "$CURR_PROF" == "home" ]; then INDP=2; else INDP=1; fi
PRIM="${MON[$INDP]}"; unset MON[$INDP];

if [ "$PRIM" == "VBOX0" ]; then
    xrandr --newmode "1920x1080_60.00"  173.00  1920 2048 2248 2576  1080 1083 1088 1120 -hsync +vsync
    xrandr --addmode VBOX0 "1920x1080_60.00"
fi

## Set primary
#if [ -z "$MAIN_DPI" ]; then MAIN_DPI=96; fi # --dpi $MAIN_DPI
xrandr --output $PRIM --auto  --primary
echo "$PRIM" >> $FL

## Set others
#for m in $MON; do #or --mode 1920x1080 --dpi 96 --pos 1366x0,
if [ ${#MON[@]} -ge 1 ]; then
    xrandr --output ${MON[0]} --auto $PLACE $PRIM
    echo "${MON[0]}" >> $FL
fi
# done

## Disable disconnected
MON=(`xrandr | grep ' disconnected' | sed 's/^\([^ ]*\).*/\1/'`)
for m in ${MON[@]}; do xrandr --output $m --off; done

