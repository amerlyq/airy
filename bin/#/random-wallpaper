#!/bin/bash

# for i in {1..2}; do
#     wget $(wget -O- -U "" "http://images.google.com/images?imgsz=xxlarge&hl=en&q=wallpaper+HD&start=$(($RANDOM%900+100))" --quiet | grep -oe 'http://[^"]*\.jpg' | head -1)
# done


amount=10

#// Regular Expressions // Do not touch these!

regex='<a href=\"(.*)[0-9]*\" target=\"_blank\">'
imgre='<img src=\"(http\:\/\/wallpapers\..*)\" class=\".*">';
fnreg='(wallpaper\-[0-9]*\..*)'

#// Start of script.

links=()
mkdir -p "Wallpapers"

content=$(curl -Ls "www.wallbase.cc/random")

while read line; do
    if [[ $line =~ $regex ]]; then
        links+=(${BASH_REMATCH[1]})
    fi
done <<< "$content"

i=0
for link in "${links[@]}"; do
    if [[ "$i" -ge "$amount" ]]; then
        break
    fi

    linkContent=$(curl -Ls $link)

    if [[ $linkContent =~ $imgre ]]; then
        image=${BASH_REMATCH[1]}
        [[ $image =~ $fnreg ]]
        filename="Wallpapers/${BASH_REMATCH[1]}"

        if [[ -f "$filename" ]]; then
            echo "File already exists, skipping download!"
            continue
        fi

        echo "Downloading $filename > $filename"
        curl "$image" -so "$filename"
        (( i++ ))
    else
        echo "Error parsing remote wallpaper path! Skipping."
        continue
    fi

done
