#!/bin/bash

# source ~/.bash_export
# if [ $? -ne 0 ]; then exit 1; fi

# To launch shell in certain directory
# ssh -t example.com "cd /foo/bar; exec \$SHELL -l"
# { SS=autossh && hash $SS >/dev/null 2>&1; } || SS=ssh

PRG="$1"
shift
ARGS="${@}"

# pane_name()  { tmux send-keys "printf '\\033]2;%s\\033\\\\' '$1'" 'C-m'; }
# $(pane_name p1)
SESSION='main'
sstmux="
which zsh >/dev/null && export SHELL=\$(which zsh)
which tmux >/dev/null && if ! tmux has-session -t $SESSION
then
    tmux new-session -d -s $SESSION -n '$PRG'
    tmux rename-window -t $SESSION:1 'work'
fi
tmux attach -t $SESSION
"

case "$PRG" in
    mpd)  ~/.bin/ssht.d/sir-mpd $ARGS ;;
    srkz) ssh srk -t zsh $ARGS ;;
    sirx) ssh sir -X ${ARGS:--t "$sstmux"} ;;
    *)    ssh $PRG ${ARGS:--t "$sstmux"} ;;
esac
