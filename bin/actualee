#!/bin/bash
# About 'file' command
#   https://www.ibm.com/developerworks/community/blogs/58e72888-6340-46ac-b488-d31aa4058e9c/entry/get_over_extensions_use_file_command_to_determine_file_types_in_linux?lang=en

NM="$1"
NAME="${NM%/*}"
EXT="${NAME##*.}"
TYPE=$(file -i "$NM" | sed 's/.*:\s*\(\S*\);\s.*/\1/;q')
FL="$PWD/$NM"


finish() {
  local ERR=$?;  if [[ "$ERR" != 0 ]]
  then pause $ERR "$NAME" || exit $ERR; fi
} && trap finish EXIT


# Names
case "$NAME" in  # Names
      Makefile*) make -f "$NAME" ;;
CMakeLists\.txt) sir ;;
*) v1=false ;; esac


[[ -n "$v1" ]] && case "$EXT" in  # Extensions
dot) dot -Tx11 "$NM"  ;;
tpp) tpp "$NM"        ;;
 md) pandoc -o /tmp/pandoc.html "$FL" && x-www-browser /tmp/pandoc.html ;;
jar) java -jar "$NM" ;;
# Launched w/o fork, because of poor cmd support: it opens new instance of
# XMind instead of adding file to opened
xmind) XMind -noSplash -- "$1" ;;
*) v2=false ;; esac


[[ -n "$v2" ]] && case "$TYPE" in  # Types
 text/x-python) "$FL"  ;;
application/x*) "$FL"  ;;
       text/x*) if [[ -x "$FL" ]]; then "$FL" || exit
                else echo "Non-executable '$FL'"; fi ;;
       video/*) [ "$2" == "-l" ] && mpv --playlist="$3" || mpv $(ls) ;;
*) v3=false ;; esac


[[ -n "$v3" ]] && case "$EXT" in
py) python "$FL" ;;
 *) { stat -c '%A' "$FL" | grep -q x; } && "$FL"
;; esac
